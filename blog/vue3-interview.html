<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue3é¢è¯•é¢˜ | å‰ç«¯å¥½å¥½ç©</title>
    <meta name="description" content="å‰ç«¯è¿›é˜¶ç½‘ç«™">
    <link rel="stylesheet" href="/assets/style.02a7d1c1.css">
    <link rel="modulepreload" href="/assets/app.a276ccf0.js">
    <link rel="modulepreload" href="/assets/blog_vue3-interview.md.e0c574dc.lean.js">
    
    <link rel="icon" type="image/png" href="pure-logo.svg">
  <script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3921855445087471" crossorigin="anonymous"></script>
  <meta name="google-adsense-account" content="ca-pub-3921855445087471">
  <script>(()=>{const e=localStorage.getItem("vitepress-theme-appearance"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-6b5fd0a9><!--[--><!--]--><!--[--><span tabindex="-1" data-v-45f6ae50></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-45f6ae50> Skip to content </a><!--]--><!----><header class="VPNav" data-v-6b5fd0a9 data-v-0e356168><div class="VPNavBar has-sidebar" data-v-0e356168 data-v-8856f192><div class="container" data-v-8856f192><div class="VPNavBarTitle has-sidebar" data-v-8856f192 data-v-6a6f7ff6><a class="title" href="/" data-v-6a6f7ff6><!--[--><img class="VPImage logo" src="/pure-logo.svg" data-v-73ae1788><!--]--><!--[-->å‰ç«¯å¥½å¥½ç©<!--]--></a></div><div class="content" data-v-8856f192><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-8856f192 data-v-a30758ee><span id="main-nav-aria-label" class="visually-hidden" data-v-a30758ee>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->é¦–é¡µ<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/frontend/javascript.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->åŸºç¡€<!--]--><!----></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-a30758ee data-v-8dccea88><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-8dccea88><span class="text" data-v-8dccea88><!----> æ¡†æ¶ <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-8dccea88><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-8dccea88><div class="VPMenu" data-v-8dccea88 data-v-e73581a2><div class="items" data-v-e73581a2><!--[--><!--[--><div class="VPMenuLink" data-v-e73581a2 data-v-06b18c43><a class="VPLink link" href="/vue/next-tick.html" data-v-06b18c43 data-v-5704c677><!--[-->Vue<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e73581a2 data-v-06b18c43><a class="VPLink link" href="/react/fiber.html" data-v-06b18c43 data-v-5704c677><!--[-->React<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-a30758ee data-v-8dccea88><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-8dccea88><span class="text" data-v-8dccea88><!----> è¿›é˜¶ <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-8dccea88><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-8dccea88><div class="VPMenu" data-v-8dccea88 data-v-e73581a2><div class="items" data-v-e73581a2><!--[--><!--[--><div class="VPMenuLink" data-v-e73581a2 data-v-06b18c43><a class="VPLink link" href="/algorithm/sort.html" data-v-06b18c43 data-v-5704c677><!--[-->ç®—æ³•<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e73581a2 data-v-06b18c43><a class="VPLink link" href="/performance/browser.html" data-v-06b18c43 data-v-5704c677><!--[-->æ€§èƒ½ä¼˜åŒ–<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/actions.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->æ–‡ç« <!--]--><!----></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-a30758ee data-v-8dccea88><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-8dccea88><span class="text" data-v-8dccea88><!----> å…³äºæˆ‘ <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-8dccea88><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-8dccea88><div class="VPMenu" data-v-8dccea88 data-v-e73581a2><div class="items" data-v-e73581a2><!--[--><!--[--><div class="VPMenuLink" data-v-e73581a2 data-v-06b18c43><a class="VPLink link" href="/me/index.html" data-v-06b18c43 data-v-5704c677><!--[-->ğŸ³<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e73581a2 data-v-06b18c43><a class="VPLink link" href="https://github.com/process1024" target="_blank" rel="noopener noreferrer" data-v-06b18c43 data-v-5704c677><!--[-->github<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-5704c677><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e73581a2 data-v-06b18c43><a class="VPLink link" href="https://juejin.cn/user/1011206427522078" target="_blank" rel="noopener noreferrer" data-v-06b18c43 data-v-5704c677><!--[-->æ˜é‡‘é¦–é¡µ<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-5704c677><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-8856f192 data-v-311055f2><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-311055f2 data-v-781f9d1b data-v-1dda4c9c><span class="check" data-v-1dda4c9c><span class="icon" data-v-1dda4c9c><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-781f9d1b><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-781f9d1b><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-8856f192 data-v-0ae890f7 data-v-4dcbaf3a><!--[--><a class="VPSocialLink" href="https://github.com/process1024" title="github" target="_blank" rel="noopener noreferrer" data-v-4dcbaf3a data-v-48c45ef6><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-48c45ef6><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="visually-hidden" data-v-48c45ef6>github</span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-8856f192 data-v-0562f5c0 data-v-8dccea88><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-8dccea88><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-8dccea88><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-8dccea88><div class="VPMenu" data-v-8dccea88 data-v-e73581a2><!----><!--[--><!--[--><!----><div class="group" data-v-0562f5c0><div class="item appearance" data-v-0562f5c0><p class="label" data-v-0562f5c0>Appearance</p><div class="appearance-action" data-v-0562f5c0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-0562f5c0 data-v-781f9d1b data-v-1dda4c9c><span class="check" data-v-1dda4c9c><span class="icon" data-v-1dda4c9c><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-781f9d1b><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-781f9d1b><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-0562f5c0><div class="item social-links" data-v-0562f5c0><div class="VPSocialLinks social-links-list" data-v-0562f5c0 data-v-4dcbaf3a><!--[--><a class="VPSocialLink" href="https://github.com/process1024" title="github" target="_blank" rel="noopener noreferrer" data-v-4dcbaf3a data-v-48c45ef6><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-48c45ef6><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="visually-hidden" data-v-48c45ef6>github</span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-8856f192 data-v-6f008456><span class="container" data-v-6f008456><span class="top" data-v-6f008456></span><span class="middle" data-v-6f008456></span><span class="bottom" data-v-6f008456></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-6b5fd0a9 data-v-92b0f14a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-92b0f14a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-92b0f14a><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-92b0f14a>Menu</span></button><a class="top-link" href="#" data-v-92b0f14a> Return to top </a></div><aside class="VPSidebar" data-v-6b5fd0a9 data-v-55e4c7db><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-55e4c7db><span class="visually-hidden" id="sidebar-aria-label" data-v-55e4c7db> Sidebar Navigation </span><!--[--><div class="group" data-v-55e4c7db><section class="VPSidebarGroup" data-v-55e4c7db data-v-1f69a7ed><div class="title" data-v-1f69a7ed><h2 class="title-text" data-v-1f69a7ed>åšå®¢</h2><div class="action" data-v-1f69a7ed><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-1f69a7ed><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-1f69a7ed><!--[--><a class="VPLink link" href="/blog/actions.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>github action</span><!--]--><!----></a><a class="VPLink link" href="/blog/bit-operation.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>ä½è¿ç®—</span><!--]--><!----></a><a class="VPLink link" href="/blog/nodejs-cache.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>nodeå®è·µæµè§ˆå™¨ç¼“å­˜</span><!--]--><!----></a><a class="VPLink link" href="/blog/next-tick.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>nextTickåŸç†è§£æ</span><!--]--><!----></a><a class="VPLink link" href="/blog/vue2-interview.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>vue2é¢è¯•é¢˜åŸç†è§£æ</span><!--]--><!----></a><a class="VPLink link active" href="/blog/vue3-interview.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>vue3é¢è¯•é¢˜åŸç†è§£æ</span><!--]--><!----></a><a class="VPLink link" href="/blog/functional.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>å‡½æ•°å¼ç¼–ç¨‹</span><!--]--><!----></a><a class="VPLink link" href="/blog/element-validate.html" data-v-1f69a7ed data-v-f53f775e data-v-5704c677><!--[--><span class="link-text" data-v-f53f775e>element-uiè¡¨å•æ ¡éªŒæºç è§£æ</span><!--]--><!----></a><!--]--></div></section></div><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-6b5fd0a9 data-v-a4c57a06><div class="VPDoc has-sidebar" data-v-a4c57a06 data-v-79ca2460><div class="container" data-v-79ca2460><div class="aside" data-v-79ca2460><div class="aside-curtain" data-v-79ca2460></div><div class="aside-container" data-v-79ca2460><div class="aside-content" data-v-79ca2460><div class="VPDocAside" data-v-79ca2460 data-v-779d834d><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline has-outline" data-v-779d834d data-v-51e5a8ce><div class="content" data-v-51e5a8ce><div class="outline-marker" data-v-51e5a8ce></div><div class="outline-title" data-v-51e5a8ce>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-51e5a8ce><span class="visually-hidden" id="doc-outline-aria-label" data-v-51e5a8ce> Table of Contents for current page </span><ul class="root" data-v-51e5a8ce><!--[--><li style="" data-v-51e5a8ce><a class="outline-link" href="#_1-vue3ä¸vue2æœ‰å“ªäº›ä¸åŒ" data-v-51e5a8ce>1. vue3ä¸vue2æœ‰å“ªäº›ä¸åŒ</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_2-vue3åœ¨å“ªäº›æ–¹é¢æå‡äº†æ€§èƒ½" data-v-51e5a8ce>2. vue3åœ¨å“ªäº›æ–¹é¢æå‡äº†æ€§èƒ½</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_3-ä»‹ç»ä¸‹composition-api" data-v-51e5a8ce>3. ä»‹ç»ä¸‹composition api</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_4-vue3çš„å“åº”å¼å®ç°" data-v-51e5a8ce>4. vue3çš„å“åº”å¼å®ç°</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_5-vue3çš„hookä¸reactçš„hookæœ‰ä»€ä¹ˆä¸åŒ" data-v-51e5a8ce>5. vue3çš„hookä¸reactçš„hookæœ‰ä»€ä¹ˆä¸åŒ</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#_6-vue3çš„dom-diffä¸reactçš„dom-diffä¸åŒ" data-v-51e5a8ce>6. vue3çš„dom diffä¸reactçš„dom diffä¸åŒ</a><!----></li><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-779d834d></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-79ca2460><div class="content-container" data-v-79ca2460><!--[--><!--]--><main class="main" data-v-79ca2460><div style="position:relative;" class="vp-doc _blog_vue3-interview" data-v-79ca2460><div><h1 id="vue3é¢è¯•é¢˜" tabindex="-1">Vue3é¢è¯•é¢˜ <a class="header-anchor" href="#vue3é¢è¯•é¢˜" aria-hidden="true">#</a></h1><p>æ¥ä¸Šç¯‡çš„é¢è¯•æ–‡ç« ï¼Œ<a href="https://juejin.cn/post/6948587166679171102" target="_blank" rel="noopener noreferrer">vue2é¢è¯•é¢˜å¤§å…¨å«æºç çº§å›ç­”</a> ï¼Œè¿™ç¯‡è®²è®²vue3å¸¸è§çš„é¢è¯•é¢˜åŠå›ç­”ã€‚</p><blockquote><p>æ°´å¹³æœ‰é™ï¼Œæœ‰è®²çš„ä¸å¯¹çš„ï¼Œå¸Œæœ›å„ä½å¤§ä½¬æŒ‡å‡ºæ¥ï¼Œæˆ–è€…æœ‰å…¶ä»–çš„é¢è¯•é¢˜æƒ³äº†è§£çš„ï¼Œæ¬¢è¿æå‡ºæ¥ï¼Œæˆ‘ç ”ç©¶ååŒæ­¥åœ¨æœ¬æ–‡ã€‚</p></blockquote><blockquote><p>ä¸ªäººæ•´ç†çš„å‰ç«¯è¿›é˜¶çŸ¥è¯†ç½‘ç«™ï¼Œæ¬¢è¿å…³æ³¨:<br> ä»“åº“åœ°å€ï¼š<a href="https://github.com/process1024" target="_blank" rel="noopener noreferrer">https://github.com/process1024</a><br> ç½‘ç«™åœ°å€: <a href="https://process1024.github.io/" target="_blank" rel="noopener noreferrer">https://process1024.github.io/</a> ã€å›½å†…è®¿é—®https://junyi-chen.gitee.io/article/</p></blockquote><h2 id="_1-vue3ä¸vue2æœ‰å“ªäº›ä¸åŒ" tabindex="-1">1. vue3ä¸vue2æœ‰å“ªäº›ä¸åŒ <a class="header-anchor" href="#_1-vue3ä¸vue2æœ‰å“ªäº›ä¸åŒ" aria-hidden="true">#</a></h2><p>å¤§çš„æ”¹åŠ¨ï¼š</p><ul><li>proxyä»£æ›¿Object.definPrototetyå“åº”å¼ç³»ç»Ÿ</li><li>tsä»£æ›¿flowç±»å‹æ£€æŸ¥</li><li>é‡æ„äº†ç›®å½•ç»“æ„ï¼Œå°†ä»£ç ä¸»è¦åˆ†æˆä¸‰ä¸ªç‹¬ç«‹çš„æ¨¡å—ï¼Œæ›´åˆ©äºé•¿æœŸç»´æŠ¤</li><li>é‡å†™vdomï¼Œä¼˜åŒ–ç¼–è¯‘æ€§èƒ½</li><li>æ”¯æŒtree shaking</li><li>å¢åŠ äº†composition api(setup)ï¼Œè®©ä»£ç æ›´æ˜“äºç»´æŠ¤</li></ul><p>å°çš„æ”¹åŠ¨:</p><ul><li>å¼‚æ­¥ç»„ä»¶éœ€è¦ defineAsyncComponent æ–¹æ³•æ¥åˆ›å»º</li><li>v-model ç”¨æ³•</li><li><code>v-ifä¼˜å…ˆçº§é«˜äºv-for</code></li><li>destroyed ç”Ÿå‘½å‘¨æœŸé€‰é¡¹è¢«é‡å‘½åä¸º unmounted</li><li>beforeDestroy ç”Ÿå‘½å‘¨æœŸé€‰é¡¹è¢«é‡å‘½åä¸º beforeUnmount</li><li>renderå‡½æ•°é»˜è®¤å‚æ•°createElementç§»é™¤æ”¹ä¸ºå…¨å±€å¼•å…¥</li><li>ç»„ä»¶äº‹ä»¶ç°åœ¨éœ€è¦åœ¨ emits é€‰é¡¹ä¸­å£°æ˜</li></ul><p>æ–°ç‰¹æ€§ï¼š</p><ul><li>ç»„åˆå¼ API</li><li>Teleport</li><li>framentsï¼ˆç»„ä»¶æ”¯æŒå¤šä¸ªæ ¹èŠ‚ç‚¹ï¼‰</li><li>createRendererï¼ˆè·¨å¹³å°çš„è‡ªå®šä¹‰æ¸²æŸ“å™¨ï¼‰</li></ul><p>æ²¡æœ‰åˆ—ä¸¾å®Œï¼Œæ¨èçœ‹å®˜ç½‘çš„<a href="https://v3.cn.vuejs.org/guide/migration/introduction.html" target="_blank" rel="noopener noreferrer">v3è¿ç§»æŒ‡å—</a></p><h2 id="_2-vue3åœ¨å“ªäº›æ–¹é¢æå‡äº†æ€§èƒ½" tabindex="-1">2. vue3åœ¨å“ªäº›æ–¹é¢æå‡äº†æ€§èƒ½ <a class="header-anchor" href="#_2-vue3åœ¨å“ªäº›æ–¹é¢æå‡äº†æ€§èƒ½" aria-hidden="true">#</a></h2><h3 id="_1-å“åº”å¼ç³»ç»Ÿæå‡" tabindex="-1">1. å“åº”å¼ç³»ç»Ÿæå‡ <a class="header-anchor" href="#_1-å“åº”å¼ç³»ç»Ÿæå‡" aria-hidden="true">#</a></h3><p>vue2åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œé€šè¿‡Object.definePropertyå¯¹dataçš„æ¯ä¸ªå±æ€§è¿›è¡Œè®¿é—®å’Œä¿®æ”¹çš„æ‹¦æˆªï¼Œgetterè¿›è¡Œä¾èµ–æ”¶é›†ã€setteræ´¾å‘æ›´æ–°ã€‚åœ¨å±æ€§å€¼æ˜¯å¯¹è±¡çš„æ—¶å€™è¿˜éœ€è¦é€’å½’è°ƒç”¨definepropertyã€‚çœ‹ä¸‹å¤§è‡´å®ç°çš„ä»£ç ï¼š</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">function observe(target) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  if (target &amp;&amp; typeof target === &quot;Object&quot;) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    Object.keys(target).forEach((key) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">      defineReactive(target, key, target[key])</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">function defineReactive(obj, key, val) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  const dep = new Dep();</span></span>
<span class="line"><span style="color:#A6ACCD;">  observe(val) // å¦‚æœå±æ€§å€¼æ˜¯å¯¹è±¡å°±éå†å®ƒçš„å±æ€§</span></span>
<span class="line"><span style="color:#A6ACCD;">  Object.defineProperty(obj, key, {</span></span>
<span class="line"><span style="color:#A6ACCD;">    get() {</span></span>
<span class="line"><span style="color:#A6ACCD;">      return val</span></span>
<span class="line"><span style="color:#A6ACCD;">    },</span></span>
<span class="line"><span style="color:#A6ACCD;">    set(v) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      val = v</span></span>
<span class="line"><span style="color:#A6ACCD;">      dep.notify();</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  })</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>è€Œå¦‚æœå±æ€§æ˜¯æ•°ç»„ï¼Œè¿˜éœ€è¦è¦†ç›–æ•°ç»„çš„ä¸ƒä¸ªæ–¹æ³•(ä¼šæ”¹å˜åŸæ•°ç»„çš„ä¸ƒä¸ªæ–¹æ³•)è¿›è¡Œå˜æ›´çš„é€šçŸ¥ï¼š</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">const arrayProto = Array.prototype</span></span>
<span class="line"><span style="color:#A6ACCD;">const arrayMethods = Object.create(arrayProto)</span></span>
<span class="line"><span style="color:#A6ACCD;">const methodsToPatch = [</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;push&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;pop&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;shift&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;unshift&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;splice&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;sort&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;reverse&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">methodsToPatch.forEach(function (method) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  const original = arrayProto[method]</span></span>
<span class="line"><span style="color:#A6ACCD;">  def(arrayMethods, method, function mutator (...args) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    const result = original.apply(this, args)</span></span>
<span class="line"><span style="color:#A6ACCD;">    const ob = this.__ob__</span></span>
<span class="line"><span style="color:#A6ACCD;">    ob.dep.notify()</span></span>
<span class="line"><span style="color:#A6ACCD;">    return result</span></span>
<span class="line"><span style="color:#A6ACCD;">  })</span></span>
<span class="line"><span style="color:#A6ACCD;">})</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>ä»è¿™å‡ æ®µä»£ç å¯ä»¥çœ‹å‡ºObject.definePropertyçš„å‡ ä¸ªç¼ºç‚¹ï¼š</p><ul><li>åˆå§‹åŒ–æ—¶éœ€è¦éå†å¯¹è±¡æ‰€æœ‰keyï¼Œå±‚çº§å¤šçš„æƒ…å†µä¸‹ï¼Œæ€§èƒ½æœ‰ä¸€å®šå½±å“</li><li>åŠ¨æ€æ–°å¢ã€åˆ é™¤å¯¹è±¡å±æ€§æ— æ³•æ‹¦æˆªï¼Œåªèƒ½ç”¨set/delete apiä»£æ›¿</li><li>ä¸æ”¯æŒæ–°çš„Mapã€Setç­‰æ•°æ®ç»“æ„</li><li>æ— æ³•ç›‘æ§åˆ°æ•°ç»„ä¸‹æ ‡çš„å˜åŒ–(ç›‘å¬çš„æ€§èƒ½ä»£ä»·å¤ªå¤§)</li></ul><p>æ‰€ä»¥åœ¨vue3ä¸­ç”¨äº†proxyå…¨é¢ä»£æ›¿Object.definePropertyçš„å“åº”å¼ç³»ç»Ÿã€‚proxyæ˜¯æ¯”è¾ƒæ–°çš„æµè§ˆå™¨ç‰¹æ€§ï¼Œæ‹¦æˆªçš„æ˜¯æ•´ä¸ªå¯¹è±¡è€Œä¸æ˜¯å¯¹è±¡çš„å±æ€§ï¼Œå¯ä»¥æ‹¦æˆªå¤šç§æ–¹æ³•ï¼ŒåŒ…æ‹¬å±æ€§çš„è®¿é—®ã€èµ‹å€¼ã€åˆ é™¤ç­‰æ“ä½œï¼Œä¸éœ€è¦åˆå§‹åŒ–çš„æ—¶å€™éå†æ‰€æœ‰å±æ€§ï¼Œå¹¶ä¸”æ˜¯æ‡’æ‰§è¡Œçš„ç‰¹æ€§ï¼Œä¹Ÿå°±æ˜¯åœ¨è®¿é—®åˆ°çš„æ—¶å€™æ‰ä¼šè§¦å‘ï¼Œå½“è®¿é—®åˆ°å¯¹è±¡å±æ€§çš„æ—¶å€™æ‰ä¼šé€’å½’ä»£ç†è¿™ä¸ªå¯¹è±¡å±æ€§ï¼Œæ‰€ä»¥æ€§èƒ½æ¯”vue2æœ‰æ˜æ˜¾çš„ä¼˜åŠ¿ã€‚</p><p>æ€»ç»“ä¸‹proxyçš„ä¼˜åŠ¿ï¼š</p><ul><li>å¯ä»¥ç›‘å¬å¤šç§æ“ä½œæ–¹æ³•ï¼ŒåŒ…æ‹¬åŠ¨æ€æ–°å¢çš„å±æ€§å’Œåˆ é™¤å±æ€§ã€hasã€applyç­‰æ“ä½œ</li><li>å¯ä»¥ç›‘å¬æ•°ç»„çš„ç´¢å¼•å’Œ length ç­‰å±æ€§</li><li>æ‡’æ‰§è¡Œï¼Œä¸éœ€è¦åˆå§‹åŒ–çš„æ—¶å€™é€’å½’éå†</li><li>æµè§ˆå™¨æ–°æ ‡å‡†ï¼Œæ€§èƒ½æ›´å¥½ï¼Œå¹¶ä¸”æœ‰æŒç»­ä¼˜åŒ–çš„å¯èƒ½</li></ul><p>çœ‹ä¸‹å¤§è‡´å®ç°æ‹¦æˆªå¯¹è±¡çš„æ–¹æ³•ã€‚</p><div class="language-typescript"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">reactive</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">object</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Target</span><span style="color:#F07178;">)[</span><span style="color:#A6ACCD;">ReactiveFlags</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">IS_READONLY</span><span style="color:#F07178;">]) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">target</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">createReactiveObject</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">mutableHandlers</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">mutableCollectionHandlers</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createReactiveObject</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  target</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Target</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  isReadonly</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">boolean</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  baseHandlers</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ProxyHandler</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  collectionHandlers</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ProxyHandler</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">proxy</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Proxy</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">baseHandlers</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">proxyMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">proxy</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// ç”¨weakMapæ”¶é›†</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">proxy</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-ç¼–è¯‘ä¼˜åŒ–ï¼ˆè™šæ‹Ÿdomä¼˜åŒ–ï¼‰" tabindex="-1">2. ç¼–è¯‘ä¼˜åŒ–ï¼ˆè™šæ‹Ÿdomä¼˜åŒ–ï¼‰ <a class="header-anchor" href="#_2-ç¼–è¯‘ä¼˜åŒ–ï¼ˆè™šæ‹Ÿdomä¼˜åŒ–ï¼‰" aria-hidden="true">#</a></h3><p>ç¼–è¯‘ä¼˜åŒ–ä¸»è¦æ˜¯é€šè¿‡é‡å†™è™šæ‹Ÿdomã€‚ä¼˜åŒ–çš„ç‚¹åŒ…æ‹¬<code>ç¼–è¯‘æ¨¡æ¿çš„é™æ€æ ‡è®°</code>ã€<code>é™æ€æå‡</code>ã€<code>äº‹ä»¶ç¼“å­˜</code></p><ul><li>é™æ€æ ‡è®°ï¼ˆPatchFlagï¼‰</li></ul><p>æ ¹æ®å°¤å¤§ç›´æ’­æ‰€è¯´ï¼Œæ›´æ–°çš„æ€§èƒ½æå‡1.3~2å€ï¼Œssræå‡2~3å€ã€‚ åœ¨å¯¹æ›´æ–°çš„èŠ‚ç‚¹è¿›è¡Œå¯¹æ¯”çš„æ—¶å€™ï¼Œåªä¼šå»å¯¹æ¯”å¸¦æœ‰é™æ€æ ‡è®°çš„èŠ‚ç‚¹ã€‚å¹¶ä¸” PatchFlag æšä¸¾å®šä¹‰äº†åå‡ ç§ç±»å‹ï¼Œç”¨ä»¥æ›´ç²¾ç¡®çš„å®šä½éœ€è¦å¯¹æ¯”èŠ‚ç‚¹çš„ç±»å‹ã€‚</p><p>çœ‹è¿™æ®µä»£ç </p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">&lt;div id=&quot;app&quot;&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;p&gt;å‰ç«¯å¥½å¥½ç©&lt;/p&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;div&gt;{{message}}&lt;/div&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">&lt;/div&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>vue2ç¼–è¯‘åçš„æ¸²æŸ“å‡½æ•°ï¼š</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">function render() {</span></span>
<span class="line"><span style="color:#A6ACCD;">  with(this) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    return _c(&#39;div&#39;, {</span></span>
<span class="line"><span style="color:#A6ACCD;">      attrs: {</span></span>
<span class="line"><span style="color:#A6ACCD;">        &quot;id&quot;: &quot;app&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }, [_c(&#39;p&#39;, [_v(&quot;å‰ç«¯å¥½å¥½ç©&quot;)]), _c(&#39;div&#39;, [_v(</span></span>
<span class="line"><span style="color:#A6ACCD;">      _s(message))])])</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>è¿™ä¸ªrenderå‡½æ•°ä¼šè¿”å›vnodeï¼Œåé¢æ›´æ–°çš„æ—¶å€™vue2ä¼šè°ƒ<code>patch</code>å‡½æ•°æ¯”æ—§vnodeè¿›è¡Œdiffç®—æ³•æ›´æ–°ï¼ˆåœ¨æˆ‘çš„ä¸Šç¯‡æ–‡ç« æœ‰è§£æè¿‡ï¼‰ï¼Œè¿™æ—¶å€™å¯¹æ¯”æ˜¯æ•´ä¸ªvnodeï¼ŒåŒ…æ‹¬é‡Œé¢çš„é™æ€èŠ‚ç‚¹<code>&lt;p&gt;å‰ç«¯å¥½å¥½ç©&lt;/p&gt;</code>ï¼Œè¿™æ ·å°±ä¼šæœ‰ä¸€å®šçš„æ€§èƒ½æŸè€—ã€‚</p><p>vue3ç¼–è¯‘åçš„æ¸²æŸ“å‡½æ•°:</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">import { createVNode as _createVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createBlock as _createBlock } from &quot;vue&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">export function render(_ctx, _cache) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  return (_openBlock(), _createBlock(&quot;div&quot;, { id: &quot;app&quot; }, [</span></span>
<span class="line"><span style="color:#A6ACCD;">    _createVNode(&quot;p&quot;, null, &quot;å‰ç«¯å¥½å¥½ç©&quot;),</span></span>
<span class="line"><span style="color:#A6ACCD;">    _createVNode(&quot;div&quot;, null, _toDisplayString(_ctx.message), 1 /* TEXT */)</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]))</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>åªæœ‰<code>_createVNode</code>è¿™ä¸ªå‡½æ•°å¸¦æœ‰ç¬¬å››ä¸ªå‚æ•°çš„æ‰æ˜¯éé™æ€èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯éœ€è¦åç»­diffçš„èŠ‚ç‚¹ã€‚ç¬¬å››ä¸ªå‚æ•°æ˜¯è¿™ä¸ªèŠ‚ç‚¹å…·ä½“åŒ…å«éœ€è¦è¢«diffçš„ç±»å‹ï¼Œæ¯”å¦‚æ˜¯<code>text</code>èŠ‚ç‚¹ï¼Œåªæœ‰è¿™ç§æ¨¡æ¿å˜é‡çš„ç»‘å®šï¼Œåç»­åªéœ€è¦å¯¹æ¯”è¿™ä¸ªtextå³å¯ï¼Œçœ‹ä¸‹æºç ä¸­å®šä¹‰äº†å“ªäº›æšä¸¾çš„å…ƒç´ ç±»å‹:</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">  TEXT = 1,// åŠ¨æ€çš„æ–‡æœ¬èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#A6ACCD;">  CLASS = 1 &lt;&lt; 1,  // 2ï¼ŒåŠ¨æ€Classçš„èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#A6ACCD;">  STYLE = 1 &lt;&lt; 2,  // 4ï¼Œè¡¨ç¤ºåŠ¨æ€æ ·å¼</span></span>
<span class="line"><span style="color:#A6ACCD;">  PROPS = 1 &lt;&lt; 3,  // 8ï¼ŒåŠ¨æ€å±æ€§</span></span>
<span class="line"><span style="color:#A6ACCD;">  FULL_PROPS = 1 &lt;&lt; 4,  // 16 åŠ¨æ€é”®å</span></span>
<span class="line"><span style="color:#A6ACCD;">  HYDRATE_EVENTS = 1 &lt;&lt; 5,  // 32 å¸¦æœ‰äº‹ä»¶ç›‘å¬å™¨çš„èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#A6ACCD;">  STABLE_FRAGMENT = 1 &lt;&lt; 6,   // 64 ä¸€ä¸ªä¸ä¼šæ”¹å˜å­èŠ‚ç‚¹é¡ºåºçš„</span></span>
<span class="line"><span style="color:#A6ACCD;">  KEYED_FRAGMENT = 1 &lt;&lt; 7, // 128 å¸¦æœ‰ key å±æ€§</span></span>
<span class="line"><span style="color:#A6ACCD;">  UNKEYED_FRAGMENT = 1 &lt;&lt; 8, // 256 å­èŠ‚ç‚¹æ²¡æœ‰ key</span></span>
<span class="line"><span style="color:#A6ACCD;">  NEED_PATCH = 1 &lt;&lt; 9,   // 512</span></span>
<span class="line"><span style="color:#A6ACCD;">  DYNAMIC_SLOTS = 1 &lt;&lt; 10,  // åŠ¨æ€æ’æ§½</span></span>
<span class="line"><span style="color:#A6ACCD;">  HOISTED = -1,  // é™æ€æå‡çš„æ ‡è®°ï¼Œä¸ä¼šè¢«diffï¼Œä¸‹é¢çš„é™æ€æå‡ä¼šæåˆ°</span></span>
<span class="line"><span style="color:#A6ACCD;">  BAIL = -2 //</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><blockquote><p><code>//</code>ä½è¿ç®—ï¼Œæœ‰ç¬¦å·å³ç§»è¿ç®—ç¬¦ï¼Œä¸äº†è§£çš„å¯ä»¥çœ‹æˆ‘æ˜é‡‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« https://juejin.cn/post/6885185633028538376</p></blockquote><ul><li>é™æ€æå‡</li></ul><p>é™æ€æå‡çš„æ„æ€å°±æ˜¯æŠŠå‡½æ•°é‡Œçš„æŸäº›å˜é‡æ”¾åˆ°å¤–é¢æ¥ï¼Œè¿™æ ·å†æ¬¡æ‰§è¡Œè¿™ä¸ªå‡½æ•°çš„æ—¶å€™å°±ä¸ä¼šé‡æ–°å£°æ˜ã€‚vue3åœ¨ç¼–è¯‘é˜¶æ®µåšäº†è¿™ä¸ªä¼˜åŒ–ã€‚è¿˜æ˜¯ä¸Šé¢é‚£æ®µä»£ç ï¼Œåˆ†åˆ«çœ‹ä¸‹vue2å’Œvue3ç¼–è¯‘åçš„ä¸åŒ</p><p>vue2:</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">function render() {</span></span>
<span class="line"><span style="color:#A6ACCD;">  with(this) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    return _c(&#39;div&#39;, {</span></span>
<span class="line"><span style="color:#A6ACCD;">      attrs: {</span></span>
<span class="line"><span style="color:#A6ACCD;">        &quot;id&quot;: &quot;app&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }, [_c(&#39;p&#39;, [_v(&quot;å‰ç«¯å¥½å¥½ç©&quot;)]), _c(&#39;div&#39;, [_v(_s(message))])])</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>vue3:</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">import { createVNode as _createVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createBlock as _createBlock } from &quot;vue&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const _hoisted_1 = { id: &quot;app&quot; }</span></span>
<span class="line"><span style="color:#A6ACCD;">const _hoisted_2 = /*#__PURE__*/_createVNode(&quot;p&quot;, null, &quot;å‰ç«¯å¥½å¥½ç©&quot;, -1 /* HOISTED */)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">export function render(_ctx, _cache, $props, $setup, $data, $options) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  return (_openBlock(), _createBlock(&quot;div&quot;, _hoisted_1, [</span></span>
<span class="line"><span style="color:#A6ACCD;">    _hoisted_2,</span></span>
<span class="line"><span style="color:#A6ACCD;">    _createVNode(&quot;div&quot;, null, _toDisplayString(_ctx.message), 1 /* TEXT */)</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]))</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°vue3å°†ä¸å˜çš„èŠ‚ç‚¹å£°æ˜æ”¾åˆ°äº†å¤–é¢å»æ‰§è¡Œï¼Œåé¢å†æ¸²æŸ“çš„æ—¶å€™ç›´æ¥å»_hoitedå˜é‡å°±è¡Œï¼Œè€Œvue2æ¯æ¬¡renderéƒ½éœ€è¦æ‰§è¡Œ_cç”Ÿæˆæ–°çš„èŠ‚ç‚¹ã€‚è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç‚¹ï¼Œ_hoisted_2çš„_createVNodeç¬¬å››ä¸ªå‚æ•°-1ï¼Œæ ‡è®°è¿™ä¸ªèŠ‚ç‚¹æ°¸è¿œä¸éœ€è¦diffã€‚</p><ul><li>äº‹ä»¶ç¼“å­˜</li></ul><p>é»˜è®¤æƒ…å†µä¸‹äº‹ä»¶è¢«è®¤ä¸ºæ˜¯åŠ¨æ€å˜é‡ï¼Œæ‰€ä»¥æ¯æ¬¡æ›´æ–°è§†å›¾çš„æ—¶å€™éƒ½ä¼šè¿½è¸ªå®ƒçš„å˜åŒ–ã€‚ä½†æ˜¯æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ @clickÂ äº‹ä»¶åœ¨è§†å›¾æ¸²æŸ“å‰å’Œæ¸²æŸ“åï¼Œéƒ½æ˜¯åŒä¸€ä¸ªäº‹ä»¶ï¼ŒåŸºæœ¬ä¸Šä¸éœ€è¦å»è¿½è¸ªå®ƒçš„å˜åŒ–ï¼Œæ‰€ä»¥ Vue 3.0 å¯¹æ­¤ä½œå‡ºäº†ç›¸åº”çš„ä¼˜åŒ–å«äº‹ä»¶ç›‘å¬ç¼“å­˜</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">&lt;div id=&quot;app&quot;&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;p @click=&quot;handleClick&quot;&gt;å‰ç«¯å¥½å¥½ç©&lt;/p&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">&lt;/div&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>vue3ç¼–è¯‘åï¼š</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">import { createVNode as _createVNode, openBlock as _openBlock, createBlock as _createBlock } from &quot;vue&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const _hoisted_1 = { id: &quot;app&quot; }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">export function render(_ctx, _cache, $props, $setup, $data, $options) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  return (_openBlock(), _createBlock(&quot;div&quot;, _hoisted_1, [</span></span>
<span class="line"><span style="color:#A6ACCD;">    _createVNode(&quot;p&quot;, {</span></span>
<span class="line"><span style="color:#A6ACCD;">      onClick: _cache[1] || (_cache[1] = (...args) =&gt; (_ctx.handleClick &amp;&amp; _ctx.handleClick(...args)))</span></span>
<span class="line"><span style="color:#A6ACCD;">    }, &quot;å‰ç«¯å¥½å¥½ç©&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]))</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°onClickæœ‰ä¸€ä¸ª_cacheåˆ¤æ–­ç¼“å­˜èµ‹å€¼çš„æ“ä½œï¼Œä»è€Œå˜æˆé™æ€èŠ‚ç‚¹</p><h3 id="_3-æºç ä½“ç§¯çš„ä¼˜åŒ–" tabindex="-1">3. æºç ä½“ç§¯çš„ä¼˜åŒ– <a class="header-anchor" href="#_3-æºç ä½“ç§¯çš„ä¼˜åŒ–" aria-hidden="true">#</a></h3><p>vue3é€šè¿‡é‡æ„å…¨å±€apiå’Œå†…éƒ¨apiï¼Œæ”¯æŒäº†tree shakingï¼Œä»»ä½•ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚refã€reavtivedã€computedç­‰ï¼Œä»…ä»…åœ¨ç”¨åˆ°çš„æ—¶å€™æ‰æ‰“åŒ…ï¼Œæ²¡ç”¨åˆ°çš„æ¨¡å—éƒ½è¢«æ‘‡æ‰ï¼Œæ‰“åŒ…çš„æ•´ä½“ä½“ç§¯å˜å°</p><h2 id="_3-ä»‹ç»ä¸‹composition-api" tabindex="-1">3. ä»‹ç»ä¸‹composition api <a class="header-anchor" href="#_3-ä»‹ç»ä¸‹composition-api" aria-hidden="true">#</a></h2><p>Composition APIæ˜¯vue3æœ€é‡è¦çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œä¸ºçš„æ˜¯æ›´å¥½çš„<code>é€»è¾‘å¤ç”¨å’Œä»£ç ç»„ç»‡</code>ï¼Œè§£å†³options apiåœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œoptions apiä¸å¥½æ‹†åˆ†å’Œé‡ç”¨çš„é—®é¢˜ã€‚</p><p>Composition apiå£°æ˜åœ¨<code>setup</code>å‡½æ•°å†…ï¼Œsetupæ˜¯åœ¨åˆ›å»ºç»„ä»¶ä¹‹å‰æ‰§è¡Œï¼Œè¿™ä¹Ÿæ„å‘³ç€è¿™æ—¶å€™ç»„ä»¶å®ä¾‹å°šæœªè¢«åˆ›å»ºï¼Œå› æ­¤åœ¨ setup é€‰é¡¹ä¸­æ²¡æœ‰ thisã€‚</p><p>setupæ¥å—<code>props</code>å’Œ<code>context</code>ä¸¤ä¸ªå‚æ•°ï¼Œpropsæ˜¯çˆ¶ç»„ä»¶ä¼ é€’çš„å‚æ•°ï¼Œå¹¶ä¸”åŸæœ¬å°±æ˜¯å“åº”å¼çš„ï¼Œcontextåˆ™æ˜¯ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼ŒåŒ…å«<code>attrs</code>ã€<code>slots</code> ã€<code>emit</code>ä¸‰ä¸ªå±æ€§ã€‚setupçš„è¿”å›å€¼å¯ä»¥åœ¨æ¨¡æ¿å’Œå…¶ä»–é€‰é¡¹ä¸­è®¿é—®åˆ°ï¼Œä¹Ÿå¯ä»¥è¿”å›æ¸²æŸ“å‡½æ•°ã€‚</p><p>vue2æ˜¯å°†dataé€‰é¡¹çš„æ•°æ®è¿›è¡Œå¤„ç†åæˆä¸ºå“åº”å¼æ•°æ®ï¼Œè€Œåœ¨vue3ä¸­è¦é€šè¿‡<code>reactive</code>å’Œ<code>ref</code>å‡½æ•°æ¥è¿›è¡Œæ•°æ®å®šä¹‰åæ‰æ˜¯å“åº”å¼æ•°æ®ã€‚è¿™æ ·åšçš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯æ¨¡æ¿ç»‘å®šçš„æ•°æ®ä¸ä¸€å®šæ˜¯éœ€è¦å“åº”å¼çš„ï¼Œvue3é€šè¿‡ç”¨æˆ·è‡ªè¡Œå†³å®šéœ€è¦å“åº”å¼çš„æ•°æ®æ¥å¤„ç†ï¼Œè€Œvue2ä¸­è¦åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨å˜é‡åªèƒ½é€šè¿‡åœ¨dataé‡Œå£°æ˜ï¼Œè¿™æ ·å°±é€ æˆäº†ä¸€å®šçš„æ€§èƒ½æµªè´¹ã€‚</p><p>å› ä¸ºsetupæ˜¯åœ¨ç»„ä»¶åˆ›å»ºä¹‹å‰æ‰§è¡Œï¼Œéœ€è¦è®¿é—®ç»„ä»¶å®ä¾‹æˆ–è€… ç”Ÿå‘½å‘¨æœŸåˆ™è¦é€šè¿‡å¼•å…¥vueæä¾›çš„å‡½æ•°ï¼Œ<code>getCurrentInstance</code>ã€<code>onMounted</code>ç­‰ç­‰ï¼Œè¿™å°±æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„æ–¹å¼ï¼Œä¹Ÿæ›´åˆ©äºä»£ç é€»è¾‘çš„æ‹†åˆ†ï¼Œå†ä¹Ÿä¸éœ€è¦mixinæ¥æ··å…¥å„ç§é€‰é¡¹äº†ã€‚</p><p>åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå¯ä»¥å°†ä¸€äº›å¤ç”¨çš„ä»£ç æŠ½ç¦»å‡ºæ¥ä½œä¸ºä¸€ä¸ªå‡½æ•°ï¼Œåªè¦åœ¨ä½¿ç”¨çš„åœ°æ–¹ç›´æ¥è¿›è¡Œè°ƒç”¨ï¼Œéå¸¸çµæ´»ï¼Œçœ‹ä¸‹å®˜æ–¹æä¾›çš„ä¾‹å­ï¼š</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">import { toRefs, reactive, onUnmounted, onMounted } from &#39;vue&#39;;</span></span>
<span class="line"><span style="color:#A6ACCD;">function useMouse(){</span></span>
<span class="line"><span style="color:#A6ACCD;">    const state = reactive({x:0,y:0});</span></span>
<span class="line"><span style="color:#A6ACCD;">    const update = e=&gt;{</span></span>
<span class="line"><span style="color:#A6ACCD;">        state.x = e.pageX;</span></span>
<span class="line"><span style="color:#A6ACCD;">        state.y = e.pageY;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    onMounted(()=&gt;{</span></span>
<span class="line"><span style="color:#A6ACCD;">        window.addEventListener(&#39;mousemove&#39;,update);</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">    onUnmounted(()=&gt;{</span></span>
<span class="line"><span style="color:#A6ACCD;">        window.removeEventListener(&#39;mousemove&#39;,update);</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    return toRefs(state);</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>ç»„ä»¶ä½¿ç”¨ï¼š</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">import useMousePosition from &#39;./mouse&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">export default {</span></span>
<span class="line"><span style="color:#A6ACCD;">    setup() {</span></span>
<span class="line"><span style="color:#A6ACCD;">        const { x, y } = useMousePosition()</span></span>
<span class="line"><span style="color:#A6ACCD;">        return { x, y }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>ä»æºç çœ‹ä¸‹setupå‡½æ•°çš„å®ç°å’Œè°ƒç”¨é€»è¾‘ï¼š åˆ›å»ºç»„ä»¶çš„æ—¶å€™ä¼šè°ƒ<code>mountComponent</code>ï¼Œåœ¨mountComponentè°ƒç”¨<code>setupComponent</code>ï¼Œå†<code>setupStatefulComponent</code>å‡½æ•°å¤„ç†ã€‚</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">function setupComponent(</span></span>
<span class="line"><span style="color:#A6ACCD;">  instance: ComponentInternalInstance,</span></span>
<span class="line"><span style="color:#A6ACCD;">  isSSR = false</span></span>
<span class="line"><span style="color:#A6ACCD;">) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  isInSSRComponentSetup = isSSR</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  const { props, children, shapeFlag } = instance.vnode</span></span>
<span class="line"><span style="color:#A6ACCD;">  const isStateful = shapeFlag &amp; ShapeFlags.STATEFUL_COMPONENT</span></span>
<span class="line"><span style="color:#A6ACCD;">  initProps(instance, props, isStateful, isSSR)</span></span>
<span class="line"><span style="color:#A6ACCD;">  initSlots(instance, children)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  const setupResult = isStateful</span></span>
<span class="line"><span style="color:#A6ACCD;">    ? setupStatefulComponent(instance, isSSR)</span></span>
<span class="line"><span style="color:#A6ACCD;">    : undefined</span></span>
<span class="line"><span style="color:#A6ACCD;">  isInSSRComponentSetup = false</span></span>
<span class="line"><span style="color:#A6ACCD;">  return setupResult // æœ€ç»ˆè¿”å›setupå¤„ç†åçš„ç»“æœ</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">function setupStatefulComponent(</span></span>
<span class="line"><span style="color:#A6ACCD;">  instance: ComponentInternalInstance,</span></span>
<span class="line"><span style="color:#A6ACCD;">  isSSR: boolean</span></span>
<span class="line"><span style="color:#A6ACCD;">) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  const Component = instance.type as ComponentOptions</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  if (__DEV__) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    if (Component.name) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      validateComponentName(Component.name, instance.appContext.config)</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    if (Component.components) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      const names = Object.keys(Component.components)</span></span>
<span class="line"><span style="color:#A6ACCD;">      for (let i = 0; i &lt; names.length; i++) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        validateComponentName(names[i], instance.appContext.config)</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    if (Component.directives) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      const names = Object.keys(Component.directives)</span></span>
<span class="line"><span style="color:#A6ACCD;">      for (let i = 0; i &lt; names.length; i++) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        validateDirectiveName(names[i])</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  // 0. create render proxy property access cache</span></span>
<span class="line"><span style="color:#A6ACCD;">  instance.accessCache = Object.create(null)</span></span>
<span class="line"><span style="color:#A6ACCD;">  // 1. create public instance / render proxy</span></span>
<span class="line"><span style="color:#A6ACCD;">  // also mark it raw so it&#39;s never observed</span></span>
<span class="line"><span style="color:#A6ACCD;">  instance.proxy = new Proxy(instance.ctx, PublicInstanceProxyHandlers)</span></span>
<span class="line"><span style="color:#A6ACCD;">  if (__DEV__) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    exposePropsOnRenderContext(instance)</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  // 2. call setup()</span></span>
<span class="line"><span style="color:#A6ACCD;">  const { setup } = Component</span></span>
<span class="line"><span style="color:#A6ACCD;">  // å¦‚æœæœ‰setupé€‰é¡¹å°±è¿›å»setupçš„å¤„ç†</span></span>
<span class="line"><span style="color:#A6ACCD;">  if (setup) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    const setupContext = (instance.setupContext =</span></span>
<span class="line"><span style="color:#A6ACCD;">      setup.length &gt; 1 ? createSetupContext(instance) : null)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    currentInstance = instance</span></span>
<span class="line"><span style="color:#A6ACCD;">    pauseTracking()</span></span>
<span class="line"><span style="color:#A6ACCD;">    const setupResult = callWithErrorHandling(</span></span>
<span class="line"><span style="color:#A6ACCD;">      setup,</span></span>
<span class="line"><span style="color:#A6ACCD;">      instance,</span></span>
<span class="line"><span style="color:#A6ACCD;">      ErrorCodes.SETUP_FUNCTION,</span></span>
<span class="line"><span style="color:#A6ACCD;">      [__DEV__ ? shallowReadonly(instance.props) : instance.props, setupContext]</span></span>
<span class="line"><span style="color:#A6ACCD;">    )</span></span>
<span class="line"><span style="color:#A6ACCD;">    // æš‚åœä¾èµ–æ”¶é›†</span></span>
<span class="line"><span style="color:#A6ACCD;">    resetTracking()</span></span>
<span class="line"><span style="color:#A6ACCD;">    currentInstance = null</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">  } else {</span></span>
<span class="line"><span style="color:#A6ACCD;">    finishComponentSetup(instance, isSSR)</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>åˆ¤æ–­æœ‰setupé€‰é¡¹å°±é€šè¿‡<code>callWithErrorHandling</code>å¼€å§‹æ‰§è¡Œsetupï¼Œè¿™ä¸ªå‡½æ•°æ‰§è¡Œsetupé€‰é¡¹å¹¶åšäº†é”™è¯¯å¤„ç†æœºåˆ¶ã€‚</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">function callWithErrorHandling(</span></span>
<span class="line"><span style="color:#A6ACCD;">  fn: Function, // è¿™ä¸ªfnå°±æ˜¯setupé€‰é¡¹</span></span>
<span class="line"><span style="color:#A6ACCD;">  instance: ComponentInternalInstance | null,</span></span>
<span class="line"><span style="color:#A6ACCD;">  type: ErrorTypes,</span></span>
<span class="line"><span style="color:#A6ACCD;">  args?: unknown[]</span></span>
<span class="line"><span style="color:#A6ACCD;">) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  let res</span></span>
<span class="line"><span style="color:#A6ACCD;">  try {</span></span>
<span class="line"><span style="color:#A6ACCD;">    res = args ? fn(...args) : fn()</span></span>
<span class="line"><span style="color:#A6ACCD;">  } catch (err) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    handleError(err, instance, type)</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  return res</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>æ‰§è¡Œå®Œååœ¨è°ƒ<code>handleSetupResult</code>å¯¹setupçš„è¿”å›å€¼è¿›è¡Œåˆ¤æ–­æ˜¯å¦åˆæ³•ï¼Œæœ€ç»ˆ<code>finishComponentSetup</code>å®Œæˆsetupå¤„ç†ï¼Œçœ‹finishComponentSetupå‡½æ•°ï¼š</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">function finishComponentSetup(</span></span>
<span class="line"><span style="color:#A6ACCD;">  instance: ComponentInternalInstance,</span></span>
<span class="line"><span style="color:#A6ACCD;">  isSSR: boolean</span></span>
<span class="line"><span style="color:#A6ACCD;">) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  const Component = instance.type as ComponentOptions</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  // template / render function normalization</span></span>
<span class="line"><span style="color:#A6ACCD;">  if (__NODE_JS__ &amp;&amp; isSSR) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    if (Component.render) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      instance.render = Component.render as InternalRenderFunction</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  } else if (!instance.render) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    // could be set from setup()</span></span>
<span class="line"><span style="color:#A6ACCD;">    if (compile &amp;&amp; Component.template &amp;&amp; !Component.render) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      if (__DEV__) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        startMeasure(instance, `compile`)</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">      Component.render = compile(Component.template, {</span></span>
<span class="line"><span style="color:#A6ACCD;">        isCustomElement: instance.appContext.config.isCustomElement,</span></span>
<span class="line"><span style="color:#A6ACCD;">        delimiters: Component.delimiters</span></span>
<span class="line"><span style="color:#A6ACCD;">      })</span></span>
<span class="line"><span style="color:#A6ACCD;">      if (__DEV__) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        endMeasure(instance, `compile`)</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    instance.render = (Component.render || NOOP) as InternalRenderFunction</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    if (instance.render._rc) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      instance.withProxy = new Proxy(</span></span>
<span class="line"><span style="color:#A6ACCD;">        instance.ctx,</span></span>
<span class="line"><span style="color:#A6ACCD;">        RuntimeCompiledPublicInstanceProxyHandlers</span></span>
<span class="line"><span style="color:#A6ACCD;">      )</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  // support for 2.x options</span></span>
<span class="line"><span style="color:#A6ACCD;">  if (__FEATURE_OPTIONS_API__) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    currentInstance = instance</span></span>
<span class="line"><span style="color:#A6ACCD;">    applyOptions(instance, Component)</span></span>
<span class="line"><span style="color:#A6ACCD;">    currentInstance = null</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  ...</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>è¿™ä¸ªå‡½æ•°æ˜¯å°†ç»‘å®šrenderå‡½æ•°åˆ°å½“å‰å®ä¾‹ instanceï¼Œç„¶åå†è°ƒ<code>applyOptions</code>å‡½æ•°å¯¹setupä¹‹å¤–çš„<code>data</code>ã€<code>computed</code>ã€<code>watch</code>ä¹‹ç±»é€‰é¡¹è¿›è¡Œå¤„ç†å’Œç”Ÿå‘½å‘¨æœŸé’©å­çš„è°ƒç”¨ã€‚æ‰€ä»¥å¯ä»¥å¾—å‡ºç»“è®ºï¼Œsetupé‡Œæ˜¯è®¿é—®ä¸åˆ°dataè¿™äº›é€‰é¡¹å’Œå…¶ä»–ç”Ÿå‘½å‘¨æœŸã€‚</p><h2 id="_4-vue3çš„å“åº”å¼å®ç°" tabindex="-1">4. vue3çš„å“åº”å¼å®ç° <a class="header-anchor" href="#_4-vue3çš„å“åº”å¼å®ç°" aria-hidden="true">#</a></h2><p>åœ¨å‰é¢æœ‰è¯´è¿‡ï¼Œvue3çš„å“åº”å¼æ˜¯é€šè¿‡proxyå®ç°çš„ï¼Œåœ¨æºç çš„<code>/packages/reactivity</code>ç›®å½•ä¸‹ã€‚</p><p>æ•´ä¸ªå“åº”å¼ç³»ç»Ÿçš„æµç¨‹å¦‚ä¸‹ï¼š</p><p>1ã€é€šè¿‡state = <code>reactive</code>(target) æ¥å®šä¹‰å“åº”å¼æ•°æ®(ä»£ç†getã€setã€deletePropertyã€hasã€ownKeysç­‰æ“ä½œ)</p><p>2ã€é€šè¿‡ <code>effect</code> å£°æ˜ä¾èµ–å“åº”å¼æ•°æ®çš„å‡½æ•°cb ( ä¾‹å¦‚è§†å›¾æ¸²æŸ“å‡½æ•°renderå‡½æ•°)ï¼Œå¹¶æ‰§è¡Œcbå‡½æ•°ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šè§¦å‘å“åº”å¼æ•°æ® <code>getter</code></p><p>3ã€åœ¨å“åº”å¼æ•°æ® <code>getter</code>ä¸­è¿›è¡Œ <code>track</code>ä¾èµ–æ”¶é›†ï¼šå­˜å‚¨å“åº”å¼æ•°æ®ä¸æ›´æ–°å‡½æ•° <code>cb</code> çš„æ˜ å°„å…³ç³»ï¼Œå­˜å‚¨äº<code>targetMap</code></p><p>4ã€å½“å˜æ›´å“åº”å¼æ•°æ®æ—¶ï¼Œè§¦å‘<code>trigger</code>ï¼Œæ ¹æ®<code>targetMap</code>æ‰¾åˆ°å…³è”çš„<code>cb</code>å¹¶æ‰§è¡Œ</p><p>é€šè¿‡æºç æ¥çœ‹ä¸‹è¿™å‡ ä¸ªå…³é”®å‡½æ•°çš„å®ç°ï¼š</p><h3 id="reactive" tabindex="-1">reactive <a class="header-anchor" href="#reactive" aria-hidden="true">#</a></h3><p><code>/packages/reactivity/reactive</code>:</p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">function reactive(target: object) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  // å¦‚æœå°è¯•è§‚å¯Ÿåªè¯»ä»£ç†ï¼Œåˆ™è¿”å›åªè¯»ç‰ˆæœ¬</span></span>
<span class="line"><span style="color:#A6ACCD;">  if (target &amp;&amp; (target as Target)[ReactiveFlags.IS_READONLY]) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    return target</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  return createReactiveObject(</span></span>
<span class="line"><span style="color:#A6ACCD;">    target,</span></span>
<span class="line"><span style="color:#A6ACCD;">    false,</span></span>
<span class="line"><span style="color:#A6ACCD;">    mutableHandlers,</span></span>
<span class="line"><span style="color:#A6ACCD;">    mutableCollectionHandlers,</span></span>
<span class="line"><span style="color:#A6ACCD;">    reactiveMap</span></span>
<span class="line"><span style="color:#A6ACCD;">  )</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">function createReactiveObject(</span></span>
<span class="line"><span style="color:#A6ACCD;">  target: Target,</span></span>
<span class="line"><span style="color:#A6ACCD;">  isReadonly: boolean,</span></span>
<span class="line"><span style="color:#A6ACCD;">  baseHandlers: ProxyHandler&lt;any&gt;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  collectionHandlers: ProxyHandler&lt;any&gt;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  proxyMap: WeakMap&lt;Target, any&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  // å¦‚æœä¸æ˜¯å¯¹è±¡ï¼Œç›´æ¥è¿”å›å³å¯</span></span>
<span class="line"><span style="color:#A6ACCD;">  if (!isObject(target)) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    if (__DEV__) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      console.warn(`value cannot be made reactive: ${String(target)}`)</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    return target</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  // ä»£ç†çš„ç›®æ ‡æœ¬èº«å°±æ˜¯ä»£ç†çš„proxyï¼Œç›´æ¥è¿”å›è‡ªèº«</span></span>
<span class="line"><span style="color:#A6ACCD;">  if (</span></span>
<span class="line"><span style="color:#A6ACCD;">    target[ReactiveFlags.RAW] &amp;&amp;</span></span>
<span class="line"><span style="color:#A6ACCD;">    !(isReadonly &amp;&amp; target[ReactiveFlags.IS_REACTIVE])</span></span>
<span class="line"><span style="color:#A6ACCD;">  ) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    return target</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  // ä»£ç†çš„ç›®æ ‡å·²ç»è¢«ä»£ç†è¿‡äº†ï¼Œç›´æ¥è¿”å›ä»£ç†å¯¹è±¡</span></span>
<span class="line"><span style="color:#A6ACCD;">  const existingProxy = proxyMap.get(target)</span></span>
<span class="line"><span style="color:#A6ACCD;">  if (existingProxy) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    return existingProxy</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  // åªèƒ½ä»£ç†å¯ä»¥ä»£ç†çš„ç™½åå•ç±»å‹å¯¹è±¡.</span></span>
<span class="line"><span style="color:#A6ACCD;">  const targetType = getTargetType(target)</span></span>
<span class="line"><span style="color:#A6ACCD;">  if (targetType === TargetType.INVALID) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    return target</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  // åˆ¤æ–­ä»£ç†çš„å¯¹è±¡ç±»å‹ï¼Œæ¥æ ¹æ®ä¸åŒçš„ç±»å‹åšä¸åŒçš„ä»£ç†å¤„ç†</span></span>
<span class="line"><span style="color:#A6ACCD;">  const proxy = new Proxy(</span></span>
<span class="line"><span style="color:#A6ACCD;">    target,</span></span>
<span class="line"><span style="color:#A6ACCD;">    targetType === TargetType.COLLECTION ? collectionHandlers : baseHandlers</span></span>
<span class="line"><span style="color:#A6ACCD;">  )</span></span>
<span class="line"><span style="color:#A6ACCD;">  // ä¿å­˜åœ¨proxyMapï¼Œé˜²æ­¢ç›®æ ‡å¯¹è±¡è¢«é‡å¤ä»£ç†</span></span>
<span class="line"><span style="color:#A6ACCD;">  proxyMap.set(target, proxy)</span></span>
<span class="line"><span style="color:#A6ACCD;">  return proxy</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>é€šè¿‡reactiveè°ƒç”¨<code>createReactiveObject</code>ç”Ÿæˆå“åº”å¼å¯¹è±¡ï¼Œå¯¹ä¼ å…¥çš„targetæœ‰åšä¸åŒæƒ…å†µçš„å¤„ç†ï¼Œproxyçš„handlerç”¨ä¼ å…¥çš„<code>baseHandlers</code>ï¼Œè¿™é‡Œé»˜è®¤ä¼ å…¥çš„æ˜¯<code>mutableHandlers</code>ï¼Œè¿™ä¸ªæ–¹æ³•ä»<code>reactivity/baseHandlers</code>å¯¼å…¥ï¼š</p><div class="language-typescript"><span class="copy"></span><pre><code><span class="line"><span style="color:#FFCB6B;">mutableHandlers</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> ProxyHandler</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">object</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  get</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  set</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  deleteProperty</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  has</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  ownKeys</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> get </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">/*#__PURE__*/</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createGetter</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> set </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">/*#__PURE__*/</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createSetter</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createGetter</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">isReadonly </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> shallow </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">symbol</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">receiver</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">object</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å¯¹æ•°ç»„åšç‰¹æ®Šçš„è¯»å–å€¼å¤„ç†</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">targetIsArray</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">isArray</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">isReadonly</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">targetIsArray</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">hasOwn</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">arrayInstrumentations</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Reflect</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">arrayInstrumentations</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">receiver</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Reflect</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">receiver</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// track ä¾èµ–æ”¶é›†</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">isReadonly</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">track</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">TrackOpTypes</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">GET</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">   </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å¦‚æœè¯»å–çš„å€¼æ˜¯å¯¹è±¡ï¼Œé€’å½’è°ƒç”¨reactiveï¼Œä½¿ä¹‹æˆä¸ºå“åº”å¼å¯¹è±¡</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">isObject</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">isReadonly</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">readonly</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">reactive</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createSetter</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">shallow </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">set</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">object</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">symbol</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">unknown</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">receiver</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">object</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">):</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">boolean</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">oldValue</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#F07178;">)[</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// åˆ¤æ–­æ˜¯æ–°å¢è¿˜æ˜¯åˆ é™¤å±æ€§</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">hadKey</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">isArray</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">isIntegerKey</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Number</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">hasOwn</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Reflect</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">receiver</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// don&#39;t trigger if target is something up in the prototype chain of original</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">toRaw</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">receiver</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">hadKey</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// triggeræ›´æ–°å‡½æ•°</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">trigger</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">TriggerOpTypes</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ADD</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">hasChanged</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">oldValue</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">trigger</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">TriggerOpTypes</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">SET</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">oldValue</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>mutableHandlerså¯¹getã€setã€deletePropertyç­‰å±æ€§æ“ä½œåšäº†å¤„ç†ï¼Œè¿™è¾¹åªåˆ†æget å’Œsetã€‚åœ¨getçš„æ—¶å€™ä¼šè¿›è¡Œ<code>track</code>ä¾èµ–æ”¶é›†ï¼Œå¦‚æœgetçš„å±æ€§å€¼æ˜¯å¯¹è±¡è¿˜ä¼šè¿›è¡Œé€’å½’å“åº”å¼å¤„ç†ï¼Œsetåˆ™ä¼š<code>trigger</code>è¿›è¡Œæ›´æ–°ã€‚</p><h3 id="track" tabindex="-1">track <a class="header-anchor" href="#track" aria-hidden="true">#</a></h3><div class="language-typescript"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">track</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">object</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TrackOpTypes</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> key</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">unknown</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">shouldTrack</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">activeEffect</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">undefined</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è·å–targetå¯¹åº”ä¾èµ–è¡¨</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">depsMap</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">targetMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">depsMap</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">targetMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">depsMap</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Map</span><span style="color:#F07178;">()))</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è·å–keyå¯¹åº”çš„å“åº”å‡½æ•°é›†åˆ</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dep</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">depsMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">dep</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// åŠ¨æ€åˆ›å»ºä¾èµ–å…³ç³»</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">depsMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">dep</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Set</span><span style="color:#F07178;">()))</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// activeEffectä¸´æ—¶å˜é‡ï¼Œgetterè§¦å‘ä¾èµ–æ”¶é›†çš„å›è°ƒå‡½æ•°ï¼Œå¯èƒ½æ˜¯renderæˆ–è€…effectç”Ÿæˆçš„å‰¯ä½œç”¨å‡½æ•°</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">dep</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">has</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">activeEffect</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">dep</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">activeEffect</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">activeEffect</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">deps</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">dep</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">__DEV__</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">activeEffect</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">onTrack</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">activeEffect</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onTrack</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        effect</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">activeEffect</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">type</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">key</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>trackä¾èµ–æ”¶é›†çš„æ—¶å€™ï¼Œå…ˆåˆ¤æ–­<code>targetMap</code>æ˜¯å¦å­˜åœ¨è®¿é—®çš„è¿™ä¸ªå¯¹è±¡ï¼ŒtargetMapæ˜¯ä¸€ä¸ªweakMapçš„ç»“æ„ï¼Œæ ¼å¼ä¸º<code>{targetï¼š{ key: [fn1,fn2]}}</code>ï¼Œtargetä¸ºweakMapçš„keyï¼Œvalueæ˜¯ä¸€ä¸ªmapç±»å‹ï¼Œkeyä¸ºè®¿é—®åˆ°çš„targetçš„å±æ€§ï¼Œå€¼ä¸ºè¿™ä¸ªå±æ€§å¯¹åº”çš„<code>å›è°ƒå‡½æ•°é›†åˆ</code>ã€‚æœ€åé¢æœ‰ä¸€ä¸ª<code>activeEffect</code>çš„åˆ¤æ–­ï¼Œè¿™ä¸ªåˆ¤æ–­ä¾èµ–æ”¶é›†çš„<code>å‰¯ä½œç”¨å‡½æ•°</code>ï¼Œè¿™ä¸ªå‰¯ä½œç”¨å‡½æ•°å¯èƒ½æ˜¯<code>ffect</code>ä¸´æ—¶ç”Ÿæˆï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯åœ¨<code>renderæ¸²æŸ“å‡½æ•°</code>ä¸´æ—¶ç”Ÿæˆçš„å‰¯ä½œç”¨å‡½æ•°ã€‚</p><h3 id="trigger" tabindex="-1">trigger <a class="header-anchor" href="#trigger" aria-hidden="true">#</a></h3><div class="language-typescript"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">trigger</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  target</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">object</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TriggerOpTypes</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  key</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">unknown</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  newValue</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">unknown</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  oldValue</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">unknown</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  oldTarget</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Map</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">unknown</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">unknown</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Set</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">unknown</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è·å–è§¦å‘æ›´æ–°çš„targetå¯¹åº”çš„å±æ€§æ˜ å°„é›†åˆ</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">depsMap</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">targetMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">depsMap</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// never been tracked</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">effects</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Set</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">ReactiveEffect</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">add</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">effectsToAdd</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Set</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">ReactiveEffect</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">undefined</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">effectsToAdd</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">effectsToAdd</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">effect</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">effect</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">activeEffect</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">effect</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">allowRecurse</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">effects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">effect</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">type</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">TriggerOpTypes</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">CLEAR</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// collection being cleared</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// trigger all effects for target</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">depsMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">add</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">length</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">isArray</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">depsMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">dep</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">length</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">newValue</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">add</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">dep</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// schedule runs for SET | ADD | DELETE</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">void</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">add</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">depsMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// also run for iteration key on ADD | DELETE | Map.SET</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æ ¹æ®è§¦å‘çš„æ“ä½œç±»å‹åšä¸åŒçš„å›è°ƒå‡½æ•°å¤„ç†</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">switch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">type</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">TriggerOpTypes</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ADD</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#82AAFF;">isArray</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#82AAFF;">add</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">depsMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ITERATE_KEY</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">isMap</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">add</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">depsMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">MAP_KEY_ITERATE_KEY</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">isIntegerKey</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;">// new index added to array -&gt; length changes</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#82AAFF;">add</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">depsMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">length</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">break</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">TriggerOpTypes</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">DELETE</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#82AAFF;">isArray</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#82AAFF;">add</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">depsMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ITERATE_KEY</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">isMap</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">add</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">depsMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">MAP_KEY_ITERATE_KEY</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">break</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">TriggerOpTypes</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">SET</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">isMap</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#82AAFF;">add</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">depsMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ITERATE_KEY</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">break</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">run</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">effect</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">ReactiveEffect</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">__DEV__</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">effect</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">onTrigger</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">effect</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onTrigger</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">effect</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">type</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">newValue</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">oldValue</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">oldTarget</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">effect</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">scheduler</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">effect</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">scheduler</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">effect</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">effect</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æ‰§è¡Œæ‰€æœ‰çš„å›è°ƒå‡½æ•°é›†åˆ</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">effects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">run</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>triggerè§¦å‘æ›´æ–°ï¼Œæ ¹æ®<code>targetsMap</code>æ‰¾åˆ°targetå¯¹åº”çš„å±æ€§ä¾èµ–é›†åˆï¼Œå†æ ¹æ®keyæ‰¾åˆ°å›è°ƒå‡½æ•°é›†åˆï¼Œç„¶åè¿˜è¦æ ¹æ®æ“ä½œç±»å‹åšå¤„ç†åï¼Œæ‰§è¡Œæ‰€æœ‰çš„å›è°ƒå‡½æ•°é›†åˆã€‚</p><h3 id="effect" tabindex="-1">effect <a class="header-anchor" href="#effect" aria-hidden="true">#</a></h3><div class="language-typescript"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">// effectæ ˆï¼Œä¿å­˜æ‰€æœ‰çš„effectå‰¯ä½œç”¨å‡½æ•°</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> effectStack</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ReactiveEffect</span><span style="color:#A6ACCD;">[] </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">effect</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">fn</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  options</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ReactiveEffectOptions</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> EMPTY_OBJ</span></span>
<span class="line"><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ReactiveEffect</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">isEffect</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">fn</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">fn</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">raw</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">effect</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">createReactiveEffect</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">fn</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">effect</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">effect</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createReactiveEffect</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">fn</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  options</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ReactiveEffectOptions</span></span>
<span class="line"><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ReactiveEffect</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">effect</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">reactiveEffect</span><span style="color:#89DDFF;">():</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">unknown</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">effect</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">active</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">scheduler</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">undefined</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fn</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// effectStackæ˜¯å¦å­˜åœ¨å½“å‰æ‰§è¡Œçš„å‰¯ä½œç”¨å‡½æ•°</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">effectStack</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">includes</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">effect</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">cleanup</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">effect</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">enableTracking</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">effectStack</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">effect</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">activeEffect</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">effect</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fn</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">finally</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">effectStack</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pop</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">resetTracking</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">activeEffect</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">effectStack</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">effectStack</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">ReactiveEffect</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">effect</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">uid</span><span style="color:#89DDFF;">++</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">effect</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">allowRecurse</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!!</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">allowRecurse</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">effect</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_isEffect</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">effect</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">active</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">effect</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">raw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fn</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">effect</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">deps</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">effect</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">options</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">effect</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><code>effectStack</code>æ ˆç»“æ„çš„æ•°ç»„ï¼Œeffectçš„æ—¶å€™ï¼Œå°†å‰¯ä½œç”¨å‡½æ•°æ”¾å…¥<code>effectStack</code>ä¸­ï¼Œå†å°†<code>activeEffect</code>ä¸´æ—¶èµ‹å€¼ä¸ºå½“å‰æ‰§è¡Œçš„<code>effect</code>å‡½æ•°ï¼Œç”¨äº<code>track</code>çš„æ—¶å€™å°†effectå‡½æ•°æ”¾å…¥å“åº”å¼æ•°æ®çš„keyçš„å›è°ƒå‡½æ•°é›†åˆï¼Œeffectæ‰§è¡Œå®Œå†å°†<code>activeEffect</code>èµ‹å€¼å›åŸæ¥<code>effectStack</code>çš„æœ«ä½å‡½æ•°ã€‚</p><h2 id="_5-vue3çš„hookä¸reactçš„hookæœ‰ä»€ä¹ˆä¸åŒ" tabindex="-1">5. vue3çš„hookä¸reactçš„hookæœ‰ä»€ä¹ˆä¸åŒ <a class="header-anchor" href="#_5-vue3çš„hookä¸reactçš„hookæœ‰ä»€ä¹ˆä¸åŒ" aria-hidden="true">#</a></h2><p>æ¯«æ— ç–‘é—®ï¼Œvue3çš„hookæ˜¯å€Ÿé‰´äº†reactçš„hookæ€æƒ³ï¼Œvue3ä¸­è‡ªå®šä¹‰hookçš„å†™æ³•ä¸reactçœ‹èµ·æ¥å¾ˆç±»ä¼¼ï¼Œä½†å®é™…ä½¿ç”¨æ˜¯æœ‰äº›è®¸ä¸åŒï¼Œè€Œå†…éƒ¨å®ç°åŸç†æ›´æ˜¯å®Œå…¨ä¸ä¸€æ ·ã€‚</p><p>é¦–å…ˆè¯´ä¸‹react hookçš„ä¸¤ä¸ªé™åˆ¶ï¼š</p><ol><li><code>åªåœ¨æœ€é¡¶å±‚ä½¿ç”¨ Hook</code>ï¼Œ<code>ä¸è¦åœ¨å¾ªç¯ï¼Œæ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ Hook</code></li><li><code>åªåœ¨ React å‡½æ•°ä¸­è°ƒç”¨ Hook</code>ï¼Œ<code>ä¸è¦åœ¨æ™®é€šçš„ JavaScript å‡½æ•°ä¸­è°ƒç”¨ Hook</code></li></ol><p>è¿™åœ¨<a href="https://zh-hans.reactjs.org/docs/hooks-rules.html#explanation" target="_blank" rel="noopener noreferrer">reactå®˜ç½‘</a>ä¹Ÿæœ‰ä¸“é—¨ä»‹ç»ã€‚</p><p>åªèƒ½åœ¨æœ€é¡¶å±‚ä½¿ç”¨Hookï¼Œè¿™æ˜¯å› ä¸ºreactçš„hookæ˜¯ä¾é è°ƒç”¨çš„é¡ºåºæ¥ç¡®è®¤stateå¯¹åº”çš„hookï¼Œæ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½ä¼šå†è°ƒç”¨hookï¼Œæ‰€ä»¥éœ€è¦ç¡®ä¿hookçš„è°ƒç”¨é¡ºåºæ˜¯ä¸ä¼šå˜çš„ã€‚</p><p>å†è¯´ä¸‹vueä¸reactä½¿ç”¨çš„ä¸åŒä¹‹å¤„ï¼š</p><ol><li>setupåªæ‰§è¡Œä¸€éï¼Œè€Œreactæ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°æ‰§è¡Œhook</li><li>Hookéœ€è¦æ›´æ–°å€¼æ—¶Vueå¯ä»¥ç›´æ¥èµ‹å€¼ï¼Œè€Œreactåˆ™éœ€è¦è°ƒç”¨hookçš„èµ‹å€¼å‡½æ•°</li><li>è°ƒç”¨é¡ºåºæ— è¦æ±‚ï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨æ¡ä»¶è¯­å¥é‡Œ</li></ol><p>å®ç°åŸç†çš„ä¸åŒï¼š</p><p>vueä¸­çš„hookæ˜¯<code>å“åº”å¼å¯¹è±¡</code>ï¼Œåœ¨renderçš„æ—¶å€™è¯»å–åˆ°å°±ä¼šè¢«<code>ä¾èµ–æ”¶é›†</code>ã€‚</p><p>reactä¸­çš„hookæœ¬è´¨æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½éœ€è¦å†æ¬¡è°ƒç”¨ï¼Œåœ¨å£°æ˜çš„æ—¶å€™æŒ‰ç…§è°ƒç”¨é¡ºåºé€šè¿‡{ value1, setValue1} -&gt; { value2, setValue2 }çš„<code>é“¾è¡¨</code>ç»“æ„å­˜å‚¨ï¼Œæ‰€ä»¥éœ€è¦ä¸¥æ ¼é™åˆ¶ Hook çš„æ‰§è¡Œé¡ºåºå’Œç¦æ­¢æ¡ä»¶è°ƒç”¨ã€‚</p><h2 id="_6-vue3çš„dom-diffä¸reactçš„dom-diffä¸åŒ" tabindex="-1">6. vue3çš„dom diffä¸reactçš„dom diffä¸åŒ <a class="header-anchor" href="#_6-vue3çš„dom-diffä¸reactçš„dom-diffä¸åŒ" aria-hidden="true">#</a></h2><p>åœ¨å‰é¢çš„vue3æ€§èƒ½æå‡çš„ä¼˜åŒ–ç‚¹æœ‰è¯´è¿‡äº†vdomç¼–è¯‘ä¼˜åŒ–é€šè¿‡<code>é™æ€èŠ‚ç‚¹ã€é™æ€æå‡å’Œäº‹ä»¶ç¼“å­˜</code>ï¼Œè€Œåœ¨reactæ˜¯æ²¡æœ‰åšè¿™ä¸ªå®ç°çš„ã€‚</p><p>reactæ˜¯é€šè¿‡æŠŠvdomæ ‘ä»¥é“¾è¡¨çš„ç»“æ„ï¼Œåˆ©ç”¨æµè§ˆå™¨çš„ç©ºé—²æ—¶é—´æ¥åšdiffï¼Œä¹Ÿå°±æ˜¯<code>æ—¶é—´åˆ‡ç‰‡</code>çš„æ¦‚å¿µï¼Œå¦‚æœè¶…è¿‡äº†16msï¼Œæœ‰åŠ¨ç”»æˆ–è€…ç”¨æˆ·äº¤äº’çš„ä»»åŠ¡ï¼Œå°±æŠŠä¸»è¿›ç¨‹æ§åˆ¶æƒè¿˜ç»™æµè§ˆå™¨ï¼Œç­‰ç©ºé—²äº†ç»§ç»­diffã€‚ç”¨çš„æ˜¯<code>requestIdleCallback</code>è¿™ä¸ªæµè§ˆå™¨çš„apiå®ç°ã€‚</p></div></div></main><footer class="VPDocFooter" data-v-79ca2460 data-v-04568844><div class="edit-info" data-v-04568844><!----><div class="last-updated" data-v-04568844><p class="VPLastUpdated" data-v-04568844 data-v-0ce8c960>Last updated: <time datatime="2024-10-28T13:32:38.000Z" data-v-0ce8c960></time></p></div></div><div class="prev-next" data-v-04568844><div class="pager" data-v-04568844><a class="pager-link prev" href="/blog/vue2-interview.html" data-v-04568844><span class="desc" data-v-04568844>Previous page</span><span class="title" data-v-04568844>vue2é¢è¯•é¢˜åŸç†è§£æ</span></a></div><div class="has-prev pager" data-v-04568844><a class="pager-link next" href="/blog/functional.html" data-v-04568844><span class="desc" data-v-04568844>Next page</span><span class="title" data-v-04568844>å‡½æ•°å¼ç¼–ç¨‹</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"algorithm_readme.md\":\"463b8517\",\"algorithm_data-struct.md\":\"2af5e369\",\"algorithm_sort.md\":\"5eac00fa\",\"blog_readme.md\":\"64fce0d9\",\"blog_actions.md\":\"29a765f7\",\"blog_bit-operation.md\":\"b01a7f0f\",\"blog_element-validate.md\":\"b7dacb4d\",\"blog_functional.md\":\"e0793741\",\"blog_next-tick.md\":\"7e24ebe7\",\"blog_nodejs-cache.md\":\"092b164a\",\"blog_vue2-interview.md\":\"396ff911\",\"blog_vue3-interview.md\":\"e0c574dc\",\"frontend_readme.md\":\"d57b0143\",\"frontend_browser.md\":\"b0714656\",\"frontend_http.md\":\"782c4b5a\",\"frontend_javascript.md\":\"983caf3c\",\"frontend_nodejs.md\":\"bac2c542\",\"full-stack_nextjs.md\":\"0f88659b\",\"index.md\":\"f580edb0\",\"me_index.md\":\"88a3aea5\",\"performance_browser.md\":\"1c4940e7\",\"react_readme.md\":\"78e9999a\",\"react_fiber.md\":\"9ab09d6c\",\"react_hook.md\":\"faa474a9\",\"vue_readme.md\":\"41c568fa\",\"vue_keep-alive.md\":\"911d78a8\",\"vue_next-tick.md\":\"4f614062\"}")</script>
    <script type="module" async src="/assets/app.a276ccf0.js"></script>
    
  </body>
</html>