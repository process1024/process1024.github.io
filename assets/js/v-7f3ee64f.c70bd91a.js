(self.webpackChunkvuepress_starter=self.webpackChunkvuepress_starter||[]).push([[195],{6008:(n,s,a)=>{"use strict";a.r(s),a.d(s,{data:()=>e});const e={key:"v-7f3ee64f",path:"/blog/Action.html",title:"GitHub Action + VuePress 部署",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"VuePress",slug:"vuepress",children:[{level:3,title:"项目搭建",slug:"项目搭建",children:[]}]},{level:2,title:"GitHub-Actions",slug:"github-actions",children:[{level:3,title:"建立仓库",slug:"建立仓库",children:[]},{level:3,title:"添加.github 相关配置文件",slug:"添加-github-相关配置文件",children:[]}]},{level:2,title:"源码",slug:"源码",children:[]},{level:2,title:"结束语",slug:"结束语",children:[]}],filePathRelative:"blog/Action.md",git:{updatedTime:1616586846e3,contributors:[]}}},5410:(n,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>j});var e=a(6252);const p=(0,e.Wm)("h1",{id:"github-action-vuepress-部署"},[(0,e.Wm)("a",{class:"header-anchor",href:"#github-action-vuepress-部署"},"#"),(0,e.Uk)(" GitHub Action + VuePress 部署")],-1),t=(0,e.Uk)("本文教你如何使用 GitHub Action + vuepress 自动化部署在 GitHub Pages。最终的代码在我的"),l={href:"https://github.com/chen-junyi/article",target:"_blank",rel:"noopener noreferrer"},c=(0,e.Uk)("GitHub"),u=(0,e.Uk)("可以看，演示可以点"),o={href:"https://chen-junyi.github.io/article/",target:"_blank",rel:"noopener noreferrer"},r=(0,e.Uk)("这里"),i=(0,e.Uk)("，演示访问不了的可以访问我的"),b={href:"https://junyi-chen.gitee.io/article/",target:"_blank",rel:"noopener noreferrer"},k=(0,e.Uk)("gitee pages 地址"),m=(0,e.Uk)("，我在 gitee 也有同步代码部署 gitee pages。"),h=(0,e.uE)('<h2 id="vuepress"><a class="header-anchor" href="#vuepress">#</a> VuePress</h2><p>VuePress 是一个以 Markdown 为中心的静态网站生成器。在本文的示例里使用的是 vue3 版本的 vuepress-next。VuePress 还能在 Markdown 里使用 Vue 语法，并且每个页面都会预渲染生成静态的 HTML，也就是说加载性能好还有非常好的 SEO 支持，非常适合用来写文档和博客。</p><h3 id="项目搭建"><a class="header-anchor" href="#项目搭建">#</a> 项目搭建</h3><h4 id="_1-创建项目"><a class="header-anchor" href="#_1-创建项目">#</a> 1.创建项目</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 创建并进入一个目录</span>\n<span class="token function">mkdir</span> vuepress-starter\n<span class="token builtin class-name">cd</span> vuepress-starter\n\n<span class="token comment"># 初始化项目</span>\n<span class="token function">git</span> init\n<span class="token function">yarn</span> init\n\n<span class="token comment"># 将 VuePress 安装为本地依赖</span>\n<span class="token function">yarn</span> <span class="token function">add</span> -D vuepress@next\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_2-添加-script-命令"><a class="header-anchor" href="#_2-添加-script-命令">#</a> 2.添加 script 命令</h4><div class="language-package ext-package line-numbers-mode"><pre class="language-package"><code>{\n  &quot;scripts&quot;: {\n    &quot;docs:dev&quot;: &quot;vuepress dev docs&quot;,\n    &quot;docs:build&quot;: &quot;vuepress build docs&quot;\n  }\n}\n\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_3-创建第一篇文章"><a class="header-anchor" href="#_3-创建第一篇文章">#</a> 3.创建第一篇文章</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir docs\necho &#39;# Hello VuePress&#39; &gt; docs/README.md\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_4-本地启动"><a class="header-anchor" href="#_4-本地启动">#</a> 4.本地启动</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yarn docs:dev\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>然后就可以打开 localhost:8080 看到 Hello Vuepress 的文章了，并且是支持热更新，因为 vuepress 就是用 webpack-dev-server 驱动的。VuePress 还有很多扩展的配置，在 docs 目录下加新建.vuepress/config.js，在这里可以配置标题、主题、语言、导航栏等等，在这里不展开描述。</p><p>最后部署的时候用 yarn docs:build 命令，会在 docs/.vuepress 生成 dist 目录，这个目录后面配置 workflow 会用到。</p><h2 id="github-actions"><a class="header-anchor" href="#github-actions">#</a> GitHub-Actions</h2><p>actions 顾名思义就是一堆动作，是一个持续集成服务，持续集成包含了拉代码、运行测试、编译代码、登录远程服务器，发布到第三方服务等等的操作，GitHub 将这些操作称为 actions。</p><p>不同项目的很多操作可以是一样的，比如拉取分支代码、缓存依赖等，每个也就是一个 action 脚本是可以共用的，所以 GitHub 允许开发者把每个操作写成独立的脚本文件，存放到代码仓库，使得其他开发者可以引用。</p>',16),d=(0,e.Uk)("GitHub 做了一个"),g={href:"https://github.com/marketplace?type=actions",target:"_blank",rel:"noopener noreferrer"},v=(0,e.Uk)("官方市场"),f=(0,e.Uk)("，可以让开发者提交 action 供其他人使用，GitHub 官方的 actions 则都放在 "),y=(0,e.Wm)("a",{href:"github.com/actions"},"github.com/actions",-1),w=(0,e.Uk)(" 里面。接下来介绍写一个 VuePress 的 action。"),_=(0,e.uE)('<h3 id="建立仓库"><a class="header-anchor" href="#建立仓库">#</a> 建立仓库</h3><p>首先在 github 上创建仓库，如果建立的仓库名称是 username.github.io，则最后访问的地址https://username.github.io/。 如果不是这个名称，则最后访问的地址是https://username.github.io/repo/ ,repo 就是仓库名字，此时还需要先修改.vuepress/config.js，该文件导出一个对象，增加 base 的配置项，值为“/repo/”。</p><h3 id="添加-github-相关配置文件"><a class="header-anchor" href="#添加-github-相关配置文件">#</a> 添加.github 相关配置文件</h3><p>在项目的根目录下新建.github/workflows 目录，workflow 就是 GitHub Actions 的配置文件。随便新建.yml 文件就是一个 flow，github 会自动运行 workflows 目录下所有的 yml 文件。介绍下 workflow 最重要的几个配置和概念。</p><ol><li>name</li></ol><p>name 字段是 workflow 的名称。如果省略该字段，默认为当前 workflow 的文件名</p><ol start="2"><li>on</li></ol><p>on 字段指定触发 workflow 的条件，通常是某些事件。在本文实例里用的是 push，指的就是当 git push 事件发生时触发该 workflow。</p><ol start="3"><li>jobs</li></ol><p>jobs 是 workflow 最重要的部分，表示 workflow 要执行的任务，可以是一个或者多个。</p><p>接下里开始就是本文示例的部署内容。</p><p>我们希望的流程是，本地改完代码，上传到 github 后能自动打包部署到 gh-pages 分支。先配置触发条件 on：</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token comment"># 触发条件</span>\n  <span class="token comment"># 每当 push 到 master 分支时触发部署</span>\n  <span class="token key atrule">push</span><span class="token punctuation">:</span>\n    <span class="token key atrule">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>master<span class="token punctuation">]</span>\n  <span class="token comment"># 是否手动触发部署</span>\n  <span class="token key atrule">workflow_dispatch</span><span class="token punctuation">:</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>接下来配置重头戏 jobs:</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">jobs</span><span class="token punctuation">:</span>\n  <span class="token key atrule">docs</span><span class="token punctuation">:</span>\n    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest <span class="token comment"># 指定运行所需要的虚拟机环境（必填）</span>\n\n    <span class="token key atrule">steps</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2\n        <span class="token key atrule">with</span><span class="token punctuation">:</span>\n          <span class="token comment"># “最近更新时间” 等 git 日志相关信息，需要拉取全部提交记录</span>\n          <span class="token key atrule">fetch-depth</span><span class="token punctuation">:</span> <span class="token number">0</span>\n\n      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Setup Node.js\n        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v1\n        <span class="token key atrule">with</span><span class="token punctuation">:</span>\n          <span class="token comment"># 选择要使用的 node 版本</span>\n          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">&quot;14&quot;</span>\n\n      <span class="token comment"># 缓存 node_modules</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Cache dependencies\n        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/cache@v2\n        <span class="token key atrule">id</span><span class="token punctuation">:</span> yarn<span class="token punctuation">-</span>cache\n        <span class="token key atrule">with</span><span class="token punctuation">:</span>\n          <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">\n            **/node_modules</span>\n          <span class="token key atrule">key</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> runner.os <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span>yarn<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">{</span> hashFiles(&#39;<span class="token important">**/yarn.lock&#39;)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>\n          <span class="token key atrule">restore-keys</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">\n            ${{ runner.os }}-yarn-</span>\n\n      <span class="token comment"># 如果缓存没有命中，安装依赖</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install dependencies\n        <span class="token key atrule">if</span><span class="token punctuation">:</span> steps.yarn<span class="token punctuation">-</span>cache.outputs.cache<span class="token punctuation">-</span>hit <span class="token tag">!=</span> &#39;true&#39;\n        <span class="token key atrule">run</span><span class="token punctuation">:</span> yarn <span class="token punctuation">-</span><span class="token punctuation">-</span>frozen<span class="token punctuation">-</span>lockfile\n\n      <span class="token comment"># 运行构建脚本</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build VuePress site\n        <span class="token key atrule">run</span><span class="token punctuation">:</span> yarn docs<span class="token punctuation">:</span>build\n\n      <span class="token comment"># 查看 workflow 的文档来获取更多信息</span>\n      <span class="token comment"># @see https://github.com/crazy-max/ghaction-github-pages</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy to GitHub Pages\n        <span class="token key atrule">uses</span><span class="token punctuation">:</span> crazy<span class="token punctuation">-</span>max/ghaction<span class="token punctuation">-</span>github<span class="token punctuation">-</span>pages@v2\n        <span class="token comment"># 环境变量</span>\n        <span class="token key atrule">env</span><span class="token punctuation">:</span>\n          <span class="token key atrule">GITHUB_TOKEN</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.ACTION_SECRET <span class="token punctuation">}</span><span class="token punctuation">}</span>\n        <span class="token key atrule">with</span><span class="token punctuation">:</span>\n          <span class="token comment"># 部署到 gh-pages 分支</span>\n          <span class="token key atrule">target_branch</span><span class="token punctuation">:</span> gh<span class="token punctuation">-</span>pages\n          <span class="token comment"># 部署目录为 VuePress 的默认输出目录</span>\n          <span class="token key atrule">build_dir</span><span class="token punctuation">:</span> docs/.vuepress/dist\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>首先 job 里配置运行这个脚本需要的虚拟机环境，这个虚拟机环境由 github 提供，可用的包括 windows、linux、macos 等环境，具体看官方文档。在此示例中其实不论哪个系统都是可以的，因为我们需要的是 node 环境，而 node 本身就是跨平台的。</p><p>接下里设置获取源码、需要的 node 版本、增加缓存依赖，这里使用官方提供的 actions/setup-node@v1、setup-node@v1、cache@v2。这里的@表示版本，使用别人的 action 时最好都加上版本，以防后面更新的 action 不兼容当前的脚本。这些前置条件配置好，接下来就是熟悉的 yarn install、yarn build:docs，安装依赖使用--frozen-lockfile 来锁定版本。最后一步就是将打包的目录更新到 gh-pages 分支。因为要更新 github 代码，所以还需要配置 github-token。 <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/61815fbd6adc4b10b5d60da9b49ab8b5~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>在仓库的 setting 下找到 secert，新建一个 secert，文件名可以随便取，在 workflow 的环境变量里 secerts 指的就是这里 secert，后面就是 secert 里文件的具体名称，在这里取为 ACTION_SECERT，env 配置 secerts.ACTION_SECRET 就行。</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/74607c18da504d63a88894d9493d6dce~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>最后指定部署的分支名称，和部署到分支的默认输出目录就行。</p><p>尝试着推送代码，可以看到仓库的 Actions 开始自动运行了，并且能看到运行的日志。 <img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fc2cd9e087804342978c671aec803489~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>运行完后访问 https://username.github.io/repo 就能看到部署后的效果了。</p><h2 id="源码"><a class="header-anchor" href="#源码">#</a> 源码</h2><p>gitHub: https://github.com/chen-junyi/article</p><p>github pages: https://chen-junyi.github.io/article/</p><p>gitee pages: https://junyi-chen.gitee.io/article/</p><p>本人整理的开源文档项目，有兴趣的可以私聊我一起维护完善~</p><h2 id="结束语"><a class="header-anchor" href="#结束语">#</a> 结束语</h2><p>有什么说的不对或者有疑问的，欢迎在下面留言交流~~</p>',29),j={render:function(n,s){const a=(0,e.up)("OutboundLink");return(0,e.wg)(),(0,e.j4)(e.HY,null,[p,(0,e.Wm)("p",null,[t,(0,e.Wm)("a",l,[c,(0,e.Wm)(a)]),u,(0,e.Wm)("a",o,[r,(0,e.Wm)(a)]),i,(0,e.Wm)("a",b,[k,(0,e.Wm)(a)]),m]),h,(0,e.Wm)("p",null,[d,(0,e.Wm)("a",g,[v,(0,e.Wm)(a)]),f,y,w]),_],64)}}}}]);